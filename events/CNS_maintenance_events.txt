#CNS-FILE

namespace = CNS  #0-99

character_event = {  # On starting a new campaign. ROOT = character controlled by the game host (in MP) or player.
	id = CNS.1
	is_triggered_only = yes
	hide_window = yes

	only_playable = yes
	ai = no

	trigger = {
		is_multiplayer_host_character = yes
		is_save_game = no
	}

	immediate = {
		if = {
			limit = { NOT = { has_alternate_start_parameter = { key = religion_names value = random } } }
			cns_set_clergyless_religion_flags = yes  #SEE CNS_maintenance_effects.txt
		}
		any_character = {
			limit = {
				is_ruler = yes
				cns_ruler_should_use_clergyless_government = yes  #SEE CNS_government_triggers.txt
			}
			cns_ruler_change_government_to_clergyless = yes  #SEE CNS_maintenance_effects.txt
			if = {  # Baron-tier temple holders use Open Elective.
				limit = { government = clergyless_temple_government }
				character_event = { id = CNS.4 }
			}
		}
	}
}

character_event = {  # On conversion or title gain. ROOT = character.
	id = CNS.2
	is_triggered_only = yes
	hide_window = yes
	only_rulers = yes

	trigger = {
		OR = {  # Fires for rulers that are OR should be using a clergyless government.
			cns_ruler_should_use_clergyless_government = yes  #SEE CNS_government_triggers.txt
			cns_ruler_is_not_using_clergyless_government = no
		}
	}

	immediate = {
		if = {
			limit = {
				government = clergyless_temple_government
				NAND = {
					cns_ruler_should_use_clergyless_government = yes
					tier = BARON
				}
			}
			set_government_type = theocracy_government  # If still clergyless, let the next steps apply the correct government.
		}
		if = {
			limit = { cns_ruler_should_use_clergyless_government = yes }
			cns_ruler_change_government_to_clergyless = yes  #SEE CNS_maintenance_effects.txt
			character_event = { id = CNS.3 days = 1 }  # Check the next day to fix anything that was messed up by hardcoded behavior.
		}
		else = {
			cns_ruler_change_government_from_clergyless = yes  #SEE CNS_maintenance_effects.txt
		}
	}
}

character_event = {  # ROOT = character that should already have been switched to a clergyless government yesterday.
	id = CNS.3
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = { cns_ruler_should_use_clergyless_government = yes }  #SEE CNS_government_triggers.txt
			cns_ruler_change_government_to_clergyless = yes  #SEE CNS_maintenance_effects.txt
		}
		if = {
			limit = { government = clergyless_temple_government }
			character_event = { id = CNS.4 days = 2 }  # 2 days after the 2nd try to work around forced Turkish succession.
		}
	}
}

character_event = {  # ROOT = Baron-tier clergyless temple holder, apply succession laws.
	id = CNS.4
	is_triggered_only = yes
	hide_window = yes
	only_rulers = yes

	trigger = {
		government = clergyless_temple_government
	}

	immediate = {
		any_demesne_title = {
			limit = { holding_type = temple }
			add_law = { law = succ_open_elective_clergyless_temple opinion_effect = no }
			if = {
				limit = { ROOT = { religion_allows_female_temple_holders = no } }
				add_law = { law = succ_agnatic_clergyless_temple opinion_effect = no }
			}
			else_if = {
				limit = { ROOT = { religion_allows_male_temple_holders = no } }
				add_law = { law = succ_enatic_clergyless_temple opinion_effect = no }
			}
			else = {
				add_law = { law = succ_cognatic_clergyless_temple opinion_effect = no }
			}
		}
		any_courtier = {
			limit = { is_ruler = no }
			character_event = { id = CNS.6 }
		}
	}
}

character_event = {  # On reformation with Non-Clerical, ROOT = reformer
	id = CNS.5
	is_triggered_only = yes
	hide_window = yes

	trigger = { has_religion_feature = religion_clergyless }

	immediate = {
		clr_flag = clergyless_religion  # This should NOT be set on a feature-using religion; remove it, just in case.
		if = {  # If combined with Autocephaly, destroy the religious head title given to the reformer.
			limit = { has_flag = cns_destroy_religious_head }
			clr_flag = cns_destroy_religious_head
			any_demesne_title = {
				limit = { controls_religion = yes }
				unsafe_destroy_landed_title = THIS
				activate_title = { title = THIS status = no }
			}
		}
	}
}

character_event = {  # On death of a clergyless temple holder, disqualify courtiers from succession.
	id = CNS.6
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		government = clergyless_temple_government
	}

	immediate = {
		any_courtier = { # Requires Guardian/Hafiz, good learning education, or any learning education + lifestyle...
			if = {   # ... but theologians that have memorized the scriptures are especially favored.
				limit = {
					trait = hafiz
					OR = {
						trait = theologian
						trait = scholarly_theologian
						trait = mastermind_theologian
					}
				}
				prestige = 10000
				character_event = { id = CNS.7 days = 1 }  # Reset their prestige the next day.
			}
			else_if = {
				limit = {
					NOR = {
						trait = hafiz
						trait = scholarly_theologian
						trait = mastermind_theologian
						AND = {
							has_education_learning_trigger = yes
							has_lifestyle_learning_trigger = yes
						}
					}
				}
				prestige = -10000
				character_event = { id = CNS.8 days = 1 }  # Restore their prestige the next day.
			}
		}
		recalc_succession = yes
	}
}

character_event = {
	id = CNS.7
	is_triggered_only = yes
	hide_window = yes
	immediate = { prestige = -10000 }
}

character_event = {
	id = CNS.8
	is_triggered_only = yes
	hide_window = yes
	immediate = { prestige = 10000 }
}

